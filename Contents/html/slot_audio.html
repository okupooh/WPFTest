<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0017)http://localhost/ -->
<html>
<head>
<!--

    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
-->
<meta http-equiv="X-UA-Compatible" content="IE=10">
<meta charset="utf-8">
<META name="GENERATOR" content="MSHTML 11.00.10570.1001">
<title>SlotTest1</title>
<HTA:APPLICATION
     ID="SlotTest1"
     APPLICATIONNAME="SlotTest1"
     SCROLL="yes"
     SINGLEINSTANCE="yes"
     NAVIGABLE="yes"
>
<!--
  <link rel="stylesheet" href="../css/dss_v2.css" media="screen">
  <link rel="stylesheet" href="../css/font-awesome.min.css">
  <link rel="stylesheet" href="../css/highlight/hybrid.css">
-->
  <script language="JavaScript" src="../js/jquery-1.12.3.min.js"></script>
<!--
  <script language="JavaScript" src="../js/highlight.pack.js"></script>
-->
</head>

<body>

<script language="JavaScript" src="data/a001/js/jquery.easing.1.3.js"></script>
<script language="JavaScript" >

var slotImg = ['slot1.jpg','slot2.jpg','slot3.jpg','slot4.jpg','slot5.jpg'];
var slotEasing = ['swing','easeOutQuart','easeOutBack','easeOutBounce'];
var slotDuration = 5;
var slotNum = 50;
var startPos = -30 * (slotNum - 3);
var stopPos = -150;
var middleNum = 7;
var kakuritu = 0.3;

var atariIdx;
var easingIdx;
var hantei;
var time;

var idTout ;
var idItvl ;
var timing ;

var result1 = new Array();
var result2 = new Array();
var result3 = new Array();

var audioReel = new Audio();
var audioStop = [ new Audio() , new Audio() , new Audio() ] ;
var audioWin = new Audio();
var audioLost = new Audio();

var delayReel = 400 ;
var isSlotStarted = false ;

document.oncontextmenu = function(){ return false; } ;
//document.body.style.zoom = "200%" ;
document.body.style.overflow = "hidden" ;
document.body.style.filter = "alpha(opacity=50)" ;

document.body.style.zoom = Math.round( ( window.innerHeight / 185 ) *100 ) + "%" ;

window.onresize = function() {
  document.body.style.zoom = Math.round( ( window.innerHeight / 185 ) *100 ) + "%" ;
} ;

/*
$(document).ready(function() {
//  atariHantei();
  atariIdx = Number($("#numWinning").val());
  hantei = atariIdx < slotImg.length ;
//alert($("#numWinning").val()) ;
  slotCreate( $("#slots_a .wrapper"), 1 );
  slotCreate( $("#slots_b .wrapper"), 2 );
  slotCreate( $("#slots_c .wrapper"), 3 );
});
*/
/*
$(document).ready(function() {
  setNumWinning( 5 ) ;
});
*/

$(document).ready(function() {
  AudioInit() ;
});


function AudioInit() {
  audioReel.src = "./data/a001/mp3/drumroll_6.mp3";
  audioStop[0].src = "./data/a001/mp3/drum_2.mp3";
  audioStop[1].src = "./data/a001/mp3/drum_2.mp3";
  audioStop[2].src = "./data/a001/mp3/drum_2.mp3";
  audioWin.src = "./data/a001/mp3/e1-004_victory_01.mp3";
  audioLost.src = "./data/a001/mp3/e1-005_defeat_01.mp3";

  audioReel.load();
  audioStop[0].load();
  audioStop[1].load();
  audioStop[2].load();
  audioWin.load();
  audioLost.load();
}

function AudioReset() {
  audioReel.loop = true ;
  audioReel.volume = 1 ;
  audioReel.playbackRate = 1 ;

  audioReel.pause();
  audioStop[0].pause();
  audioStop[1].pause();
  audioStop[2].pause();
  audioWin.pause();
  audioLost.pause();

  audioReel.currentTime = 0;
  audioStop[0].currentTime = 0;
  audioStop[1].currentTime = 0;
  audioStop[2].currentTime = 0;
  audioWin.currentTime = 0;
  audioLost.currentTime = 0;
}


function slotStartOnBrowser( numWin , duration ) {
  if ( isSlotStarted ) return false ;

  isSlotStarted = true ;

  slotDuration = duration ;

  setTimeout( function() {
    isSlotStarted = false ;
  }, (slotDuration+6)*1000);

  return true ;
};

function slotStartOnWebView( numWin , duration ) {
  if ( isSlotStarted ) return false ;

  isSlotStarted = true ;

  slotDuration = duration ;
  setNumWinning( numWin ) ;

  setTimeout( function() {
    slotStart() ;
  }, 1000);

  setTimeout( function() {
    window.chrome.webview.postMessage( "closeWindow" ) ;
    isSlotStarted = false ;
  }, (slotDuration+6)*1000);

  return true ;
};


function setNumWinning( numWin ) {
  if ( --numWin < 0 ) numWin = 128 ;
  
  atariIdx = numWin ;
  hantei = atariIdx < slotImg.length ;
  slotCreate( $("#slots_a .wrapper"), 1 );
  slotCreate( $("#slots_b .wrapper"), 2 );
  slotCreate( $("#slots_c .wrapper"), 3 );
};

function atariHantei(){
  atariIdx = Math.floor(Math.random() * slotImg.length);
  hantei = Math.random() < kakuritu;
};

function slotCreate(obj, slotno){

  obj.stop(true, true);
  obj.children().remove();
  
  var save_result1 = result1[slotno];
  var save_result2 = result2[slotno];
  var save_result3 = result3[slotno];
  
  for (var i = 1; i <= slotNum; i++) {
    var idx = Math.floor(Math.random() * slotImg.length);
  //  idx=4;
    //  当たり以外で出目が揃うのを回避
    if ( ! hantei && slotno>2 && ( result2[1] == idx || result2[2] == idx || result2[3] == idx ) ) {
      if ( ++idx >= slotImg.length ) idx=0;
    }
  
    if (i == middleNum-1) {
      result1[slotno] = idx;
    } else if (i == middleNum) {
      if (hantei) {
        idx = atariIdx;
      }
      result2[slotno] = idx;
    } else if (i == middleNum+1) {
      result3[slotno] = idx;
    } else if (i == slotNum-2) {
      if (save_result1 != undefined) {
        idx = save_result1;
      }
    } else if (i == slotNum-1) {
      if (save_result2 != undefined) {
        idx = save_result2;
      }
    } else if (i == slotNum) {
      if (save_result3 != undefined) {
        idx = save_result3;
      }
    }
    obj.append("<div class='slot'>"
    + "<img border='0'"
    + " src='data/a001/img/" + slotImg[idx] + "'"
    + " width='40' height='26' />"
    + "</div>");
  }

  obj.css({
    "margin-top" : startPos + "px"
  });
}

function slotStart(){ 
  $("#slotMsg").html("GO !!");

//  if ($("#slots_a .wrapper").css("margin-top") != startPos + "px"){
//    atariHantei();
//  }
  
  time = slotDuration * 1000;
  easingIdx = Math.floor(Math.random() * slotEasing.length);

  AudioReset() ;
  audioReel.play() ;

  slotMove( $("#slots_a .wrapper"), 1 );
  setTimeout( function() {
    slotMove($("#slots_b .wrapper"), 2 );
  }, delayReel);
  setTimeout( function() {
    slotMove($("#slots_c .wrapper"), 3 );
  }, delayReel*2);

  $(this).delay(time-300).queue(function() {
    audioReel.pause();
    audioStop[0].play() ;
    setTimeout( function() {
      audioStop[1].play() ;
    }, delayReel);
    setTimeout( function() {
      audioStop[2].play() ;
    }, delayReel*2);
    $(this).dequeue();
  });


  $(this).delay(1000+delayReel*2).queue(function() {
    if (hantei && result2[1] == result2[2] && result2[1] == result2[3]) {
        $("#slotMsg").html("BINGO !!!");
        audioWin.play() ;
    } else {
        $("#slotMsg").html("TRY AGAIN");
        audioLost.play() ;
    }
    $(this).dequeue();
  });

/*  
  $(this).delay(3000).queue(function() {
  //    window.location.href("about:blank") ;
//    $("#startBtn").prop('disabled', false);
  //  window.chrome.webview.postMessage( "closeWindow" ) ;
    $(this).dequeue();
  });
*/

}

function slotMove(obj, slotno){

  if (obj.css("margin-top") != startPos + "px"){
    slotCreate( obj, slotno );
  }
  
  obj.animate({
    "margin-top" : stopPos + "px"
  }, {
    'duration' : time,
    'easing' : slotEasing[easingIdx] // ,
/*
    'complete' :  function() {
                    audioReel1.pause();
                    audioReel3.currentTime = 0;
                    audioReel3.play() ;
                  }
*/
  });

};
</script>

<style>
* {
  box-sizing: border-box;
}

body { 
  background-color: transparent;
/*
  background-color: #10100E;
*/
}

#slots_a,
#slots_b,
#slots_c {
  position: relative;
  float: left;
  width: 48px;
  height: 94px;
  background-color: white;
  border: 2px palegoldenrod outset;
  overflow: hidden;
}

#slots_a .wrapper,
#slots_b .wrapper,
#slots_c .wrapper {
  position: absolute;
  width: 46px;
}

#slots_a .wrapper .slot,
#slots_b .wrapper .slot,
#slots_c .wrapper .slot {
  width: 46px;
  height: 30px;
  text-align: center;
  padding-top: 2px;
}

.slotglass-top {
  position: absolute;
  z-index: 999;
  width: 46px;
  height: 15px;
  background: -moz-linear-gradient(top, rgba(20,20,20,0.3), rgba(20,20,20,0));
  background: -webkit-gradient(linear, left top, left bottom, from(rgba(20,20,20,0.3)), to(rgba(20,20,20,0)));
  background: -o-linear-gradient(top, rgba(20,20,20,0.3), rgba(20,20,20,0));
  background: linear-gradient(top, rgba(20,20,20,0.3), rgba(20,20,20,0));
}

.slotglass-bottom {
  position: absolute;
  z-index: 999;
  width: 45px;
  height: 15px;
  bottom: 0px;
  background: -moz-linear-gradient(top, rgba(20,20,20,0), rgba(20,20,20,0.3));
  background: -webkit-gradient(linear, left top, left bottom, from(rgba(20,20,20,0)), to(rgba(20,20,20,0.3)));
  background: -o-linear-gradient(top, rgba(20,20,20,0), rgba(20,20,20,0.3));
  background: linear-gradient(top, rgba(20,20,20,0), rgba(20,20,20,0.3));
}

.slotline {
  position: absolute;
  z-index: 999;
  width: 45px;
  height: 2px;
  top: 44px;
  opacity: 0.8;
  background-color: red;
}

#slotbox {
  background-color: #A1272E;
  box-shadow: 0px 0px 15px -5px rgba(0, 0, 0, 0.8);
  border-radius: 5px;
  width: 185px;
  padding: 20px;
  margin: 0 0 ;
}

#slotMsg {
  background-color: black;
  color: white;
  font-weight: bold;
  font-size: 1em;
  text-align: center;
  border: 1px #C0C0C0 inset;
  border-radius: 5px;
  width: 100%;
  margin: 5px 0;
}

#startBtn {
  border-radius: 10px;
  background-color: gold;
  width: 100%;
  color: white;
  font-weight: bold;
  text-shadow:1px 1px 2px #333;
  outline: 0;
/*
  display:none;
*/
}
</style>

<div id="slotbox">

<div id="slots_a">
  <div class="wrapper"></div>
  <div class="slotglass-top"></div>
  <div class="slotglass-bottom"></div>
  <div class="slotline"></div>
</div>
<div id="slots_b">
  <div class="wrapper"></div>
  <div class="slotglass-top"></div>
  <div class="slotglass-bottom"></div>
  <div class="slotline"></div>
</div>
<div id="slots_c">
  <div class="wrapper"></div>
  <div class="slotglass-top"></div>
  <div class="slotglass-bottom"></div>
  <div class="slotline"></div>
</div>

<br style="clear: both" />

<!--
<div id="slotMsg" onclick="javascript:slotStartOnBrowser( 16 , 5 );" >Let's Start<br/></div>
-->
<div id="slotMsg">Let's Start<br/></div>
<!--
<input id="startBtn" type="button" value="START" onclick="javascript:slotStart();" />
<input id="numWinning" type="hidden" value="16" />
-->
</div>

<!--
<div id="test01"/>
-->

</div>
</body>
</HTML>
